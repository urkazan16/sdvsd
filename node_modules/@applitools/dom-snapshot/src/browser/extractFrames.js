'use strict';
const flat = require('./flat');

function extractFrames(documents = [document]) {
  const iframes = flat(
    documents.map(d => Array.from(d.querySelectorAll('iframe[src]:not([src=""])'))),
  );
  return iframes
    .map(srcEl => {
      try {
        const contentDoc = srcEl.contentDocument;
        return (
          contentDoc &&
          /^https?:$/.test(contentDoc.location.protocol) &&
          contentDoc.defaultView &&
          contentDoc.defaultView.frameElement &&
          contentDoc
        );
      } catch (err) {
        //for CORS frames
      }
    })
    .filter(x => !!x);
}

module.exports = extractFrames;
