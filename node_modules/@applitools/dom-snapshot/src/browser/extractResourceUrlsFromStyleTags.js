'use strict';
const uniq = require('./uniq');

function makeExtractResourceUrlsFromStyleTags(extractResourcesFromStyleSheet) {
  return function extractResourceUrlsFromStyleTags(doc) {
    return uniq(
      Array.from(doc.querySelectorAll('style')).reduce((resourceUrls, styleEl) => {
        const styleSheet = Array.from(doc.styleSheets).find(
          styleSheet => styleSheet.ownerNode === styleEl,
        );
        return styleSheet
          ? resourceUrls.concat(extractResourcesFromStyleSheet(styleSheet, doc))
          : resourceUrls;
      }, []),
    );
  };
}

module.exports = makeExtractResourceUrlsFromStyleTags;
