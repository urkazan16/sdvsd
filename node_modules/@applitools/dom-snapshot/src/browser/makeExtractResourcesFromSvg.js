'use strict';

function makeExtractResourcesFromSvg({parser, decoder}) {
  return function(svgArrayBuffer) {
    let svgStr;
    let urls = [];
    try {
      const decooder = decoder || new TextDecoder('utf-8');
      svgStr = decooder.decode(svgArrayBuffer);
      const domparser = parser || new DOMParser();
      const doc = domparser.parseFromString(svgStr, 'image/svg+xml');

      const fromImages = Array.from(doc.getElementsByTagName('image'))
        .concat(Array.from(doc.getElementsByTagName('use')))
        .map(e => e.getAttribute('href') || e.getAttribute('xlink:href'));
      const fromObjects = Array.from(doc.getElementsByTagName('object')).map(e =>
        e.getAttribute('data'),
      );
      urls = fromImages.concat(fromObjects).filter(u => u[0] !== '#');
    } catch (e) {
      console.log('could not parse svg content', e);
    }
    return urls;
  };
}

module.exports = makeExtractResourcesFromSvg;
